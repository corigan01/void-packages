# Template file for 'phosh'
pkgname=phosh
version=0.24.0
revision=1
_gvc_commit=ae1a34aafce7026b8c0f65a43c9192d756fe1057
_libcall_ui_commit=7e2f9e2db6515fb9c4650010c2a9ecb9796957e3
_gmobile_commit=6504fa124438b79a2ad5687ac3ebef6d7a2c0823
build_style=meson
build_wrksrc="phosh-v${version}"
hostmakedepends="phoc glib-devel gettext pkg-config wayland-devel"
makedepends="libfeedback-devel gcr-devel gnome-desktop-devel pam-devel
 polkit-devel pulseaudio-devel libsecret-devel libhandy1-devel
 NetworkManager-devel upower-devel elogind-devel libgudev-devel
 libcallaudio-devel evolution-data-server-devel libadwaita-devel evince-devel"
depends="phoc squeekboard gnome-session gnome-settings-daemon elogind
 xorg-server-xwayland cantarell-fonts font-adobe-source-code-pro"
short_desc="Wayland shell for GNOME on mobile devices"
maintainer="Jan Christian Gr√ºnhage <jan.christian@gruenhage.xyz>"
license="GPL-3.0-or-later"
homepage="https://gitlab.gnome.org/World/Phosh/phosh"
distfiles="https://gitlab.gnome.org/World/Phosh/phosh/-/archive/v${version}/phosh-v${version}.tar.gz
 https://gitlab.gnome.org/GNOME/libgnome-volume-control/-/archive/${_gvc_commit}/gvc-${_gvc_commit}.tar.gz
 https://gitlab.gnome.org/World/Phosh/libcall-ui/-/archive/${_libcall_ui_commit}/libcall-ui-${_libcall_ui_commit}.tar.gz
 https://gitlab.gnome.org/guidog/gmobile/-/archive/${_gmobile_commit}/gmobile-${_gmobile_commit}.tar.gz"
checksum="83921a2907926bed24cc8a76d06830ec9dd44271f86bbd9a23af21fd82979e5e
 afc9a7c7fd6de8252430878a753b4dbfd09033a54055e4020ced3d26609143ee
 85bd900221449f0f530314db7b3bc69ce812313e916373f7129df919555cb678
 11d0fafbf79b0da6dc615b5701e331e9b6193e53efb76fb4cb3aec42d4eea81c"
# Checking requires running a wayland session
make_check=no

post_extract() {
	cd ${build_wrksrc}
	rm -rf subprojects/gvc
	rm -rf subprojects/libcall-ui
	rm -rf subprojects/gmobile
	mv ../libgnome-volume-control-${_gvc_commit} subprojects/gvc
	mv ../libcall-ui-${_libcall_ui_commit} subprojects/libcall-ui
	mv ../gmobile-${_gmobile_commit} subprojects/gmobile
}

post_install() {
	vcopy ${FILESDIR}/sm.puri.OSK0.desktop usr/share/applications
	vcopy ${FILESDIR}/phosh.desktop usr/share/wayland-sessions
}
