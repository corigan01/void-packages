# Template file for 'feedbackd'
pkgname=feedbackd
version=0.0.3
revision=1
_gmobile_commit=d483537aee4778b114ce5d50c4c8a9f8d58337ed
build_style=meson
build_helper=gir
build_wrksrc="feedbackd-v${version}"
hostmakedepends="vala glib-devel pkg-config"
makedepends="gsound-devel libgudev-devel json-glib-devel"
depends="dbus"
checkdepends="dbus"
short_desc="Daemon to provide haptic feedback on events"
maintainer="Jan Christian Gr√ºnhage <jan.christian@gruenhage.xyz>"
license="GPL-3.0-or-later"
homepage="https://source.puri.sm/Librem5/feedbackd"
distfiles="https://source.puri.sm/Librem5/feedbackd/-/archive/v${version}/feedbackd-v${version}.tar.gz
 https://gitlab.gnome.org/guidog/gmobile/-/archive/${_gmobile_commit}/gmobile-${_gmobile_commit}.tar.gz"
checksum="bfb9baaf80bfc82130f86eb5d3a75651ef0b14fa1435badf3941483495dbf1db
 f337c0ceda3e21f1bd3b9774b2d9c92858c6b9ce7530bd52aeba13535e622d4f"

post_extract() {
	cd ${build_wrksrc}
	rm -r subprojects/gmobile
	mv ../gmobile-${_gmobile_commit} subprojects/gmobile
}

post_install() {
	vinstall debian/feedbackd.udev 0644 usr/lib/udev/rules.d 90-feedbackd.rules
}

libfeedback_package() {
	short_desc+=" - shared libraries"
	pkg_install() {
		vmove "usr/lib/*.so.*"
	}
}

libfeedback-devel_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/pkgconfig
		vmove "usr/lib/*.so"
	}
}
